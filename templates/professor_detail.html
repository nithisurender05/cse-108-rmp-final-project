{% extends "base.html" %}

{% block content %}
<div class="card mb-4">
    <div class="card-body">
        <h1>{{ professor.name }}</h1>
        <h4 class="text-muted">{{ professor.department }} - {{ professor.university }}</h4>
        <h2 class="mt-3">Average Rating: <span class="badge bg-success">{{ avg_rating }} / 5</span></h2>
    </div>
</div>

<form method="GET" action="{{ url_for('professor_detail', id=professor.id) }}" class="row g-3 mb-4">
    <div class="col-auto">
        <input type="text" name="course" class="form-control" 
               placeholder="Filter by Course" 
               value="{{ request.args.get('course', '') }}">
    </div>
    <div class="col-auto">
        <button type="submit" class="btn btn-secondary">Filter</button>
        
        {% if request.args.get('course') %}
            <a href="{{ url_for('professor_detail', id=professor.id) }}" class="btn btn-outline-secondary">Clear</a>
        {% endif %}
    </div>
</form>

<h3>Student Reviews</h3>
{% for review in reviews %}
<div class="card mb-3">
    <div class="card-header d-flex justify-content-between">
        <strong>Course: {{ review.course_code }}</strong>
        <span class="badge bg-primary">Rating: {{ review.rating }}/5</span>
    </div>
    <div class="card-body">
        <p class="card-text">{{ review.comment }}</p>
        
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-success btn-sm" onclick="vote({{ review.id }}, 1)">
                üëç Like
            </button>
            <button type="button" class="btn btn-outline-danger btn-sm" onclick="vote({{ review.id }}, -1)">
                üëé Dislike
            </button>
        </div>
    </div>
</div>
{% else %}
    <p>No reviews yet. Be the first!</p>
{% endfor %}

<hr>

{% if current_user.is_authenticated %}
<div class="card bg-light">
    <div class="card-body">
        <h4>Write a Review</h4>
        <form method="POST" action="{{ url_for('add_review', id=professor.id) }}">
            <div class="mb-3">
                <label>Course Code</label>
                <input type="text" name="course" class="form-control" required placeholder="e.g. MATH 201">
            </div>
            <div class="mb-3">
                <label>Rating (1-5)</label>
                <select name="rating" class="form-select">
                    <option value="5">5 - Excellent</option>
                    <option value="4">4 - Good</option>
                    <option value="3">3 - Average</option>
                    <option value="2">2 - Poor</option>
                    <option value="1">1 - Terrible</option>
                </select>
            </div>
            <div class="mb-3">
                <label>Comment</label>
                <textarea name="comment" class="form-control" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-success">Submit Review</button>
        </form>
    </div>
</div>
{% else %}
    <div class="alert alert-info">Please <a href="{{ url_for('login') }}">login</a> to add a review.</div>
{% endif %}

{% endblock %}